<!doctype html>
<html><!-- InstanceBegin template="file:///C|/Users/jayrb/OneDrive/Documents/udacity-git-examples/Templates/catalog-template.dwt" codeOutsideHTMLIsLocked="false" -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="Content-Language" content="en">
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles.css') }}" >
<!-- InstanceBeginEditable name="doctitle" -->
<title>Untitled Document</title>
<!-- InstanceEndEditable -->
<!-- InstanceBeginEditable name="head" -->
<!-- InstanceEndEditable -->
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
<meta name="google-signin-scope" content="profile email">
<meta name="google-signin-client_id" content="222190778761-87bhkrer20mq5q9q852hm23131h2n1bu.apps.googleusercontent.com">
<script src="https://apis.google.com/js/platform.js" async defer></script>
<script src="https://apis.google.com/js/client:platform.js" async defer></script>
</head>
<body>
<header>
	<a href="{{url_for('catalog')}}">Catalog App</a>
	<div id="signinButton">
		<span class="g-signin2"
		data-onsuccess="signInCallback"
		data-theme="dark"		
		data-redirecturi="postmessage"
		data-accesstype="offline"
		data-cookiepolicy="single_host_origin"
		data-callback="signInCallback"></span>
	</div>
	<a id="signoutButton" href="#" onclick="signOut();">Sign out</a>
	<script>
	  function signOut() {
		var auth2 = gapi.auth2.getAuthInstance();
		auth2.signOut().then(function () {
		  	console.log('User signed out.');
			$.ajax({
			  type: 'POST',
			  url: '/logout/',
			  processData: false,
			  success: function(result) {
				// Handle or verify the server response if necessary.
				if (result) {
				  $('#result').html(result);
			  	}
			  }
			});
		  });
	  	}
	</script>
	<div id="result"></div>
  <script>
		function signInCallback(authResult) {
		  if (authResult['code']) {
			  // Display the signoutButton now that the user is authorized
			  $('#signoutButton').attr('style','display: visible')
			// Send the one-time-use code to the server, if the server responds, write a 'login successful' message to the web page and then redirect back to the main catalog page
			$.ajax({
			  type: 'POST',
			  url: '/gconnect?state={{STATE}}',
			  processData: false,
			  data: authResult['code'],
			  contentType: 'application/octet-stream; charset=utf-8',
			  success: function(result) {
				// Handle or verify the server response if necessary.
				if (result) {
				  $('#result').html('Login Successful!</br>'+ result);
			  } else if (authResult['error']) {
					console.log('There was an error: ' + authResult['error']);
				  } else {
						$('#result').html('Failed to make a server-side call. Check your configuration and console.');
						 }
			  }
		  }); } }
		</script>
</header>
<!-- InstanceBeginEditable name="body" -->

<!-- InstanceEndEditable -->
</body>
<!-- InstanceEnd --></html>
